import{Q as T}from"./QKnob.a223b6ff.js";import{Q as z,a as A}from"./QTabs.d6390e2c.js";import{u as E,Q as F}from"./use-quasar.c0324529.js";import{Y as $,q as r,z as D,m as K,o as u,c as i,a as t,F as _,aK as Q,b as n,w as o,a7 as q,al as L,a6 as m,P as I,$ as M,a3 as j,aH as R,aI as W,a4 as k,t as H,v as O,a1 as Y,Z}from"./index.cde20d85.js";import{Q as C}from"./QInput.286e18dc.js";import{Q as G}from"./QTable.2e14d786.js";import{Q as J}from"./QItemLabel.45906cc2.js";import{Q as X}from"./QVirtualScroll.69496eb3.js";import{_ as ee}from"./Request-form.5df30e90.js";import"./rtl.61fc98d8.js";import"./uid.937d8ee7.js";import"./use-checkbox.d1d4d1c5.js";import"./QCardActions.4f2104f5.js";const ae={key:0,class:"q-pa-md"},te={class:"text-center flex column",style:{width:"60%",height:"80%","align-items":"center","justify-content":"center"}},le={class:"text-subtitle2 text-grey-8 q-mb-sm"},oe={class:"text-h4 text-bold text-primary"},se={class:"text-subtitle2 text-grey-8 q-mt-sm"},re={style:{display:"flex","justify-content":"center"}},ne="Auto-deduct",we={__name:"Salary-advance",setup(ue){const c=$(),y=r(!1),w=r(!0),f=r(""),s=r(null),p=r(!1),b=r(),g=r(),v=E(),P=r([{name:"repaymentId",align:"center",label:"Id",field:l=>l.repaymentId,sortable:!0},{name:"date",label:"Repayment Date",align:"center",field:l=>l.date,sortable:!0},{name:"amount",label:"Amount ",align:"center",field:l=>l.amount}]),V=r([]),h=async()=>{try{await c.fetchUserProfile(),s.value=c.currentUser,V.value=c.currentUser.salaryAdvances[0].repayments}catch(l){console.log("Error",l)}};D(h);const U=async()=>{try{s.value.salaryAdvances[0].borrowedAmount!=0?v.notify({type:"negative",message:"Please clear existing loan to request a new one"}):y.value=!0}catch(l){console.log("Error",l)}},S=async()=>{try{const l=parseFloat(b.value);if(isNaN(l)||l<=0){v.notify({type:"negative",message:"Invalid amount!"});return}const a=s.value.salaryAdvances&&s.value.salaryAdvances.length>0?s.value.salaryAdvances[0].advanceId:null;if(!a){v.notify({type:"negative",message:"No advance found for the user!"});return}(await Z.post("/pay",{userId:s.value.id,source:g.value.label,amount:l,advanceId:a})).status===200&&(v.notify({type:"positive",message:"Advance paid successfully"}),await h(),p.value=!1)}catch(l){console.log("Error",l)}},x=K(()=>{var e,d;const l=((e=c.user.salaryAdvances[0])==null?void 0:e.borrowedAmount)||0,a=((d=c.user.salaryAdvances[0])==null?void 0:d.amount)||1;return l/a*100}),B=[{label:"Mobile",value:"Mobile",description:"Enter amount you with to withdraw",icon:"money"},{label:"Card A",value:"CardA",description:"Choose the card you wish to use",icon:"payments"}];return(l,a)=>(u(),i(_,null,[t(ee,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e)},null,8,["modelValue"]),s.value?(u(),i("div",ae,[(u(!0),i(_,null,Q(s.value.salaryAdvances,(e,d)=>(u(),i("div",{class:"q-pa-md flex flex-center",key:d},[t(T,{"show-value":"","font-size":"10px",class:"q-ma-md",modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=N=>x.value=N),size:"250px",thickness:.25,color:"primary","track-color":"grey-3"},{default:o(()=>[n("div",te,[n("h6",le,m(e.remainingAmount)+" Credit available ",1),n("h6",oe,m(x.value.toFixed(0))+"% ",1),n("h6",se,m(e.borrowedAmount)+" Credited ",1)])]),_:2},1032,["modelValue"])]))),128)),n("div",null,[t(z,{class:"bg-transparent"},{default:o(()=>[t(A,{name:"Borrow",icon:"payments",label:"Borrow",onClick:U,class:"text-grey-8 bg-transparent"}),t(A,{name:"Pay",icon:"payments",label:"Pay",onClick:a[2]||(a[2]=e=>p.value=!0),class:"text-grey-8 bg-transparent"}),t(A,{class:"q-ma-none q-pa-none"},{default:o(()=>[t(F,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=e=>w.value=e),color:"primary",class:"","switch-label":""},null,8,["modelValue"]),n("div",{class:"q-toggle-label"},m(ne))]),_:1})]),_:1})]),n("div",null,[t(G,{title:"Salary Advances",rows:V.value,columns:P.value,"row-key":"name",flat:"",bordered:"",filter:f.value,"virtual-scroll":"",class:"q-ma-none q-pa-none"},{"top-right":o(()=>[t(C,{borderless:"",dense:"",debounce:"300",modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value=e),placeholder:"Search"},{append:o(()=>[t(I,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])])])):q("",!0),t(L,{modelValue:p.value,"onUpdate:modelValue":a[7]||(a[7]=e=>p.value=e),position:"bottom"},{default:o(()=>[s.value?(u(),M(Y,{key:0,class:"q-pa-lg"},{default:o(()=>[(u(!0),i(_,null,Q(s.value.salaryAdvances,(e,d)=>(u(),i("div",{key:d},[n("h6",null,"Total Credit: "+m(e.borrowedAmount),1)]))),128)),t(C,{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=e=>b.value=e),label:"Amount",placeholder:"Ksh 1,000"},null,8,["modelValue"]),t(X,{modelValue:g.value,"onUpdate:modelValue":a[6]||(a[6]=e=>g.value=e),options:B,label:"Pay from",color:"teal",clearable:"","options-selected-class":"text-deep-orange"},{option:o(e=>[t(j,R(W(e.itemProps)),{default:o(()=>[t(k,{avatar:""},{default:o(()=>[t(I,{name:e.opt.icon},null,8,["name"])]),_:2},1024),t(k,null,{default:o(()=>[t(J,null,{default:o(()=>[H(m(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),n("div",re,[t(O,{rounded:"",label:"Pay Credit",onClick:S,color:"primary","text-color":"white",size:"14px",class:"q-mt-xl q-px-xl"})])]),_:1})):q("",!0)]),_:1},8,["modelValue"])],64))}};export{we as default};
